<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aude Analytics - Final Fixed</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.bundled.js"></script>
    
    <style>
        /* --- 1. VARIABLES --- */
        :root {
            --bg-main: #FFFEFA;
            --color-vivid: #E89C48;
            --color-dark: #1A3C34;
            --color-accent: #00B2E3;
            --text-body: #666666;
            
            /* Dataviz */
            --c-artif: #D64541; --c-agri: #F2CA27; --c-nature: #88C425; --c-water: #4A90E2;
            
            /* Treemaps */
            --tm-mint: #A0D9B4; --tm-forest: #56B880; --tm-darkblue: #3B4A6B; 
            --tm-grey: #B0B0B0; --tm-bright: #68D48E;

            /* Effects */
            --ease-premium: cubic-bezier(0.25, 1, 0.5, 1);
        }

        * { box-sizing: border-box; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            font-family: 'DM Sans', sans-serif; background-color: var(--bg-main); 
            color: var(--text-body); overflow-x: hidden; scroll-behavior: smooth;
        }

        /* --- 2. SIDEBAR (FONDU + INTERACTIF) --- */
        .sidebar {
            position: fixed; left: 0; top: 0; height: 100vh; width: 80px;
            background: transparent; /* Invisible */
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 2000; pointer-events: none; /* Laisse passer les clics autour */
        }
        
        .scroll-indicators { 
            pointer-events: auto; /* Réactive les clics sur les points */
            display: flex; flex-direction: column; gap: 25px; 
            padding: 10px;
        }
        
        .dot { 
            width: 10px; height: 10px; background: #D1D1D1; border-radius: 50%; 
            cursor: pointer; transition: all 0.4s var(--ease-premium); position: relative;
        }
        
        /* État Actif (Orange) */
        .dot.active { 
            background: var(--color-vivid); 
            transform: scale(1.6); 
            box-shadow: 0 0 0 4px rgba(232, 156, 72, 0.2);
        }
        
        /* Tooltip au survol */
        .dot:hover::after {
            content: attr(data-title); position: absolute; left: 25px; top: -3px;
            background: var(--color-dark); color: white; padding: 4px 8px; 
            border-radius: 4px; font-size: 0.7rem; white-space: nowrap; opacity: 1;
        }

        .burger {
            position: fixed; top: 40px; right: 40px; width: 40px; height: 40px;
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 6px;
            cursor: pointer; z-index: 3000; background: white; border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s;
        }
        .burger div { width: 20px; height: 2px; background: var(--color-dark); border-radius: 2px; }
        .burger:hover { transform: scale(1.1); }

        /* --- 3. LAYOUT --- */
        .main-content { margin-left: 0; width: 100%; }
        .page-section { 
            min-height: 100vh; width: 100%; display: flex; 
            position: relative; border-bottom: 1px solid rgba(0,0,0,0.03); 
            padding-left: 80px;
        }

        /* TYPO */
        h1 { font-family: 'Playfair Display'; font-size: 5.5rem; font-weight: 700; color: var(--color-vivid); margin: 0; line-height: 0.9; }
        h2 { font-family: 'Playfair Display'; font-size: 3.5rem; font-weight: 700; color: var(--color-dark); margin: 15px 0 25px 0; line-height: 1.1; }
        .subtitle { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; color: var(--color-vivid); font-weight: 700; display: block; margin-bottom: 15px; }
        .description-text { font-size: 1.1rem; line-height: 1.7; color: #666; max-width: 550px; margin: 0; }
        .separator { width: 60px; height: 4px; background: var(--color-vivid); border: none; margin: 30px 0; }

        /* --- 4. PAGE 1 --- */
        .p1-content { width: 50%; padding: 0 8%; display: flex; flex-direction: column; justify-content: center; }
        .p1-map-container { width: 50%; background: #F8F9FA; position: relative; }
        #map-home { height: 100%; width: 100%; mix-blend-mode: multiply; opacity: 0.8; }
        .kpi-section { margin-top: 50px; display: flex; gap: 50px; }
        .big-number { font-family: 'Playfair Display'; font-size: 4rem; font-weight: 700; color: var(--color-dark); line-height: 1; }
        .big-number span { display: block; font-family: 'DM Sans'; font-size: 0.9rem; color: #999; font-weight: 700; text-transform: uppercase; margin-top: 5px; }

        /* --- 5. PAGE 2 (SPLIT) --- */
        .compare-wrapper { width: 50%; height: 100vh; display: flex; border-left: 2px solid #fff; }
        .map-split { width: 50%; height: 100%; position: relative; border-right: 2px solid #fff; transition: width 0.4s var(--ease-premium); }
        .map-split:hover { width: 65%; }
        .map-split:hover + .map-split { width: 35%; }

        .map-badge-pill {
            position: absolute; top: 30px; left: 50%; transform: translateX(-50%);
            background: #FFFFFF; padding: 8px 20px; border-radius: 50px;
            font-family: 'DM Sans'; font-size: 0.8rem; font-weight: 700; color: var(--color-dark);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15); z-index: 500; white-space: nowrap;
            display: flex; flex-direction: column; align-items: center; line-height: 1.2;
        }
        .map-badge-pill span { font-size: 0.65rem; color: #999; text-transform: uppercase; letter-spacing: 1px; }

        .pedagogy-box { background: rgba(232, 156, 72, 0.08); border-left: 4px solid var(--color-vivid); padding: 25px; border-radius: 0 12px 12px 0; margin-top: 30px; display: flex; gap: 20px; }
        .legend-box { display: flex; gap: 20px; margin-top: 30px; padding: 15px 25px; background: #fff; border: 1px solid #eee; border-radius: 50px; width: fit-content; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; font-weight: 700; color: #555; }
        .color-dot { width: 12px; height: 12px; border-radius: 50%; }

        /* --- 6. PAGE 3 (DASHBOARD) --- */
        .p3-layout { display: flex; width: 100%; height: 100vh; }
        .p3-map-area { width: 40%; height: 100%; position: relative; border-right: 1px solid #eee; }
        #map-viz { width: 100%; height: 100%; }

        .map-overlay { position: absolute; top: 30px; left: 30px; z-index: 1000; display: flex; flex-direction: column; gap: 15px; width: 320px; }

        .capsule-select-wrapper {
            position: relative; background: #FFFFFF; border: 1px solid #ccc;
            border-radius: 50px; padding: 0; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s;
        }
        .capsule-select-wrapper:hover { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .capsule-select {
            width: 100%; padding: 14px 25px; border: none; background: transparent;
            font-family: 'DM Sans'; font-size: 1rem; font-weight: 700; color: #333;
            appearance: none; -webkit-appearance: none; cursor: pointer; outline: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 20px center; background-size: 16px;
        }

        .filter-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px; }
        .filter-btn { 
            border: none; padding: 8px 16px; border-radius: 20px; font-size: 0.75rem; 
            font-weight: 700; color: #fff; cursor: pointer; transition: 0.2s; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }
        .filter-btn:hover { transform: translateY(-2px); }
        .filter-btn.inactive { opacity: 0.4; filter: grayscale(1); box-shadow: none; }

        .p3-deck-area { width: 60%; height: 100%; display: flex; flex-direction: column; justify-content: center; padding-left: 5%; background: #fff; }
        .kpi-row { display: flex; gap: 50px; margin: 30px 0; }
        .kpi-box { border-left: 4px solid var(--color-accent); padding-left: 20px; }
        .kpi-val { font-size: 2.5rem; font-weight: 700; color: var(--color-dark); line-height: 1; }
        .kpi-lbl { font-size: 0.8rem; font-weight: 700; color: #999; text-transform: uppercase; margin-top: 5px; letter-spacing: 1px; }

        .deck-container { display: flex; align-items: center; height: 450px; width: 100%; position: relative; overflow-x: visible; }
        .deck-card {
            min-width: 280px; width: 280px; height: 380px;
            background: #FFF; border-radius: 16px; 
            box-shadow: -10px 0 30px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.03);
            margin-right: -150px; position: relative; transition: 0.5s var(--ease-premium);
            cursor: pointer; display: flex; flex-direction: column; overflow: hidden;
        }
        .deck-card:hover { transform: translateY(-10px) rotate(-1deg); z-index: 10; }
        .deck-card.active {
            min-width: 480px; width: 480px; margin-right: 40px;
            z-index: 50; transform: scale(1.05); cursor: default;
            box-shadow: 0 30px 60px rgba(0,0,0,0.12); border: 1px solid var(--color-vivid);
        }
        .deck-header { padding: 25px; background: #fafafa; border-bottom: 1px solid #f0f0f0; }
        .deck-title { font-weight: 700; color: var(--color-dark); font-size: 1.1rem; }
        .chart-content { flex: 1; padding: 30px; opacity: 0; transition: 0.3s; display: flex; flex-direction: column; gap: 15px; }
        .deck-card.active .chart-content { opacity: 1; transition-delay: 0.2s; }
        
        .chart-row { display: flex; align-items: center; font-size: 0.9rem; transition: opacity 0.3s; }
        .chart-row.dimmed { opacity: 0.15; filter: grayscale(100%); }
        .chart-lbl { width: 80px; text-align: right; margin-right: 15px; font-weight: 600; color: #888; }
        .chart-bg { flex: 1; height: 12px; background: #f0f0f0; border-radius: 6px; overflow: hidden; }
        .chart-fill { height: 100%; border-radius: 6px; width: 0%; transition: width 1s ease; }
        .chart-val { width: 50px; text-align: right; font-weight: 700; color: var(--color-dark); }

        /* --- 7. PAGE 4 --- */
        #page4 { padding: 0 10%; flex-direction: column; justify-content: center; }
        .treemap-section { width: 100%; margin-bottom: 50px; }
        .treemap-header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .treemap-title { font-family: 'Playfair Display'; font-size: 1.8rem; color: var(--color-dark); margin: 0; }
        
        .tm-container { width: 100%; height: 260px; display: flex; gap: 4px; border-radius: 8px; overflow: hidden; }
        .tm-item { position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; cursor: default; transition: 0.3s; }
        .tm-item:hover { filter: brightness(1.1); transform: scale(1.02); z-index: 5; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .tm-col { display: flex; flex-direction: column; gap: 4px; }
        .tm-row { display: flex; gap: 4px; flex: 1; }
        .tm-lbl { font-weight: 700; font-size: 1rem; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tm-pct { font-size: 1.3rem; font-weight: 700; opacity: 0.9; }

        .cta-btn {
            background: var(--color-dark); color: #fff; padding: 18px 50px; 
            border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 1.1rem;
            display: inline-flex; align-items: center; gap: 10px; transition: 0.3s;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-top: 30px;
        }
        .cta-btn:hover { background: var(--color-vivid); transform: translateY(-3px); }

    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="scroll-indicators">
            <div class="dot active" data-title="Accueil" onclick="scrollToId('page1')" id="dot1"></div>
            <div class="dot" data-title="Correction" onclick="scrollToId('page2')" id="dot2"></div>
            <div class="dot" data-title="Explorer" onclick="scrollToId('page3')" id="dot3"></div>
            <div class="dot" data-title="Structure" onclick="scrollToId('page4')" id="dot4"></div>
        </div>
    </aside>

    <div class="burger"><div></div><div></div><div></div></div>

    <div class="main-content">
        
        <section class="page-section" id="page1">
            <div class="p1-content">
                <span class="subtitle">Analyse Géographique</span>
                <h1>Aude<br>Analytics.</h1>
                <hr class="separator">
                <p class="description-text">Une exploration cartographique nouvelle génération. Comprenez l'occupation des sols, les zones naturelles et l'évolution de l'artificialisation.</p>
                <div class="kpi-section">
                    <div class="big-number">6.139<span>km² Surface</span></div>
                    <div class="big-number">35%<span>Forêts</span></div>
                </div>
            </div>
            <div class="p1-map-container"><div id="map-home"></div></div>
        </section>

        <section class="page-section" id="page2">
            <div class="p1-content">
                <span class="subtitle">Cas d'étude</span>
                <h2>Correction<br>Algorithmique.</h2>
                <p class="description-text">La parcelle 95 passe de <strong style="color:var(--c-artif)">ARTIFICIALISÉ</strong> à <strong style="color:var(--c-nature)">NATURE</strong>.</p>
                <div class="pedagogy-box">
                    <i class="fas fa-lightbulb" style="color:var(--color-vivid); font-size:1.5rem; margin-top:2px;"></i>
                    <div>
                        <strong style="color:var(--color-dark); display:block; margin-bottom:5px;">Pourquoi c'est important ?</strong>
                        <span style="font-size:0.9rem; color:#666;">Impact direct sur le calcul du ZAN.</span>
                    </div>
                </div>
                <div class="legend-box">
                    <div class="legend-item"><div class="color-dot" style="background:var(--c-artif)"></div>Artif.</div>
                    <div class="legend-item"><div class="color-dot" style="background:var(--c-agri)"></div>Agri.</div>
                    <div class="legend-item"><div class="color-dot" style="background:var(--c-nature)"></div>Nature</div>
                </div>
            </div>
            
            <div class="compare-wrapper">
                <div id="map-left" class="map-split">
                    <div class="map-badge-pill">OSO 2023 <span>(Ancien)</span></div>
                </div>
                <div id="map-right" class="map-split">
                    <div class="map-badge-pill">COSIA 2024 <span>(Corrigé)</span></div>
                </div>
            </div>
        </section>

        <section class="page-section" id="page3">
            <div class="p3-layout">
                <div class="p3-map-area">
                    <div class="map-overlay">
                        <div class="capsule-select-wrapper">
                            <select class="capsule-select" onchange="updateDashboard(this.value)">
                                <option value="global">Vue Départementale</option>
                                <option value="carcassonne">Carcassonne</option>
                                <option value="narbonne">Narbonne</option>
                                <option value="limoux">Limoux</option>
                            </select>
                        </div>
                        <div class="filter-row">
                            <button class="filter-btn" style="background:var(--c-water)" onclick="toggleFilter('water', this)">Eau</button>
                            <button class="filter-btn" style="background:var(--c-nature)" onclick="toggleFilter('forest', this)">Forêt</button>
                            <button class="filter-btn" style="background:var(--c-agri)" onclick="toggleFilter('agri', this)">Agri</button>
                            <button class="filter-btn" style="background:var(--c-artif)" onclick="toggleFilter('artif', this)">Bâti</button>
                        </div>
                    </div>
                    <div id="map-viz"></div>
                </div>

                <div class="p3-deck-area">
                    <span class="subtitle">Données Comparées</span>
                    <h2 style="margin:0;" id="dashTitle">Aude Global</h2>
                    <div class="kpi-row">
                        <div class="kpi-box"><div class="kpi-val" id="kpiSurf">6 139</div><div class="kpi-lbl">Surface (km²)</div></div>
                        <div class="kpi-box"><div class="kpi-val" id="kpiInd">3.45</div><div class="kpi-lbl">Indice Pression</div></div>
                    </div>
                    <div class="deck-container">
                        <div class="deck-card active" onclick="activateDeck(this)">
                            <div class="deck-header"><div class="deck-title">Données OSO (Ref)</div></div>
                            <div class="chart-content">
                                <div class="chart-row row-forest"><div class="chart-lbl">Forêt</div><div class="chart-bg"><div id="b1-for" class="chart-fill" style="width:37%; background:var(--c-nature)"></div></div><div class="chart-val">37%</div></div>
                                <div class="chart-row row-agri"><div class="chart-lbl">Agri</div><div class="chart-bg"><div id="b1-agr" class="chart-fill" style="width:41%; background:var(--c-agri)"></div></div><div class="chart-val">41%</div></div>
                                <div class="chart-row row-artif"><div class="chart-lbl">Bâti</div><div class="chart-bg"><div id="b1-art" class="chart-fill" style="width:5%; background:var(--c-artif)"></div></div><div class="chart-val">5%</div></div>
                                <div class="chart-row row-water"><div class="chart-lbl">Eau</div><div class="chart-bg"><div class="chart-fill" style="width:1.1%; background:var(--c-water)"></div></div><div class="chart-val">1.1%</div></div>
                            </div>
                        </div>
                        <div class="deck-card" onclick="activateDeck(this)">
                            <div class="deck-header"><div class="deck-title">Données CLC</div></div>
                            <div class="chart-content">
                                <div class="chart-row row-forest"><div class="chart-lbl">Forêt</div><div class="chart-bg"><div id="b2-for" class="chart-fill" style="width:35%; background:var(--c-nature)"></div></div><div class="chart-val">35%</div></div>
                                <div class="chart-row row-agri"><div class="chart-lbl">Agri</div><div class="chart-bg"><div id="b2-agr" class="chart-fill" style="width:50%; background:var(--c-agri)"></div></div><div class="chart-val">50%</div></div>
                                <div class="chart-row row-artif"><div class="chart-lbl">Bâti</div><div class="chart-bg"><div id="b2-art" class="chart-fill" style="width:7%; background:var(--c-artif)"></div></div><div class="chart-val">7%</div></div>
                                <div class="chart-row row-water"><div class="chart-lbl">Eau</div><div class="chart-bg"><div class="chart-fill" style="width:0.7%; background:var(--c-water)"></div></div><div class="chart-val">0.7%</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="page-section" id="page4">
            <div style="width:100%; text-align:center;">
                <span class="subtitle" style="justify-content:center;">Vue Macro</span>
                <h2>Structure du Territoire.</h2>
            </div>
            <div style="width:100%;">
                <div class="treemap-section">
                    <div class="treemap-header"><h3 class="treemap-title">Couverture du sol</h3><span style="color:#999; font-weight:700;">NOV 2025</span></div>
                    <div class="tm-container">
                        <div class="tm-item" style="flex:51; background:var(--tm-mint);"><div class="tm-lbl">Herbacées</div><div class="tm-pct">51%</div></div>
                        <div class="tm-item" style="flex:25; background:var(--tm-forest);"><div class="tm-lbl">Forêt</div><div class="tm-pct">25%</div></div>
                        <div class="tm-col" style="flex:24;">
                            <div class="tm-row">
                                <div class="tm-item" style="flex:6; background:var(--tm-darkblue);"><div class="tm-lbl" style="font-size:0.8rem">Conifères</div></div>
                                <div class="tm-item" style="flex:5; background:var(--c-water);"><div class="tm-lbl" style="font-size:0.8rem">Eau</div></div>
                            </div>
                            <div class="tm-row">
                                <div class="tm-item" style="flex:1; background:var(--tm-bright);"></div>
                                <div class="tm-item" style="flex:1; background:var(--tm-grey);"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="treemap-section">
                    <div class="treemap-header"><h3 class="treemap-title">Usages du sol</h3></div>
                    <div class="tm-container">
                        <div class="tm-item" style="flex:49; background:var(--tm-darkblue);"><div class="tm-lbl">Agriculture</div><div class="tm-pct">49%</div></div>
                        <div class="tm-item" style="flex:32; background:var(--tm-grey);"><div class="tm-lbl">Sylviculture</div><div class="tm-pct">32%</div></div>
                        <div class="tm-item" style="flex:10; background:var(--tm-forest);"><div class="tm-lbl">Naturel</div><div class="tm-pct">10%</div></div>
                        <div class="tm-col" style="flex:9;">
                            <div class="tm-item" style="flex:1; background:var(--tm-mint); font-size:0.7rem;">Résidentiel</div>
                            <div class="tm-row"><div class="tm-item" style="flex:1; background:var(--tm-bright);"></div><div class="tm-item" style="flex:1; background:var(--tm-bright);"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="text-align:center; margin-top:40px;"><a href="map.html" class="cta-btn">Accéder à la Carte Interactive <i class="fas fa-arrow-right"></i></a></div>
        </section>
        <div style="height:10vh;"></div>
    </div>

    <script>
        // --- NAVIGATION ---
        function scrollToId(id) { document.getElementById(id).scrollIntoView({ behavior: 'smooth' }); }
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
                    const activeId = entry.target.id;
                    const dot = document.querySelector(`.dot[onclick*="${activeId}"]`);
                    if(dot) dot.classList.add('active');
                    // Refresh carto pour éviter les gris
                    if(activeId === 'page2') { 
                        setTimeout(() => { mapLeft.invalidateSize(); mapRight.invalidateSize(); }, 200); 
                    }
                }
            });
        }, { threshold: 0.5 });
        document.querySelectorAll('.page-section').forEach(s => observer.observe(s));

        // --- PAGE 1 (MAP ACCUEIL) ---
        var mapHome = L.map('map-home', {zoomControl:false, attributionControl:false}).setView([43.1026, 2.4140], 9);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(mapHome);
        fetch('https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/departements/11-aude/departement-11-aude.geojson')
        .then(r=>r.json()).then(d=>L.geoJSON(d,{style:{color:'#E89C48', weight:1, fillOpacity:0.1}}).addTo(mapHome));

        // --- PAGE 2 (COMPARATEUR) ---
        var center = [43.18, 2.35]; 
        var zoomLvl = 15;
        
        var mapLeft = L.map('map-left', {zoomControl:false, attributionControl:false}).setView(center, zoomLvl);
        var mapRight = L.map('map-right', {zoomControl:false, attributionControl:false}).setView(center, zoomLvl);

        // Fond satellite
        var satUrl = 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';
        L.tileLayer(satUrl).addTo(mapLeft);
        L.tileLayer(satUrl).addTo(mapRight);

        // Synchro
        mapLeft.on('move', () => mapRight.setView(mapLeft.getCenter(), mapLeft.getZoom(), {animate:false}));
        mapRight.on('move', () => mapLeft.setView(mapRight.getCenter(), mapRight.getZoom(), {animate:false}));

        // STYLE OCS (Couleurs)
        function styleOCS(feature) {
            // Détection automatique du nom de la colonne (Code, Classe, Gridcode...)
            var p = feature.properties;
            var type = p.Classe || p.classe || p.CODE || p.gridcode || p.c_ocs || 1; 
            
            var color = '#D64541'; // Défaut rouge (Artif)
            
            // Logique floue pour attraper tes valeurs
            var tStr = String(type).toLowerCase();
            if (tStr == '2' || tStr.includes('agri')) color = '#F2CA27'; // Jaune
            if (tStr == '3' || tStr.includes('for') || tStr.includes('nat')) color = '#88C425'; // Vert
            if (tStr == '4' || tStr.includes('eau')) color = '#4A90E2'; // Bleu

            return { fillColor: color, weight: 1, color: color, fillOpacity: 0.6 };
        }

        // CHARGEMENT SECURISÉ
        function loadLayer(url, mapInstance, styleFunc, name) {
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(`Fichier introuvable (${response.status})`);
                    return response.json();
                })
                .then(data => {
                    var layer = L.geoJSON(data, { style: styleFunc }).addTo(mapInstance);
                    if(name === 'OSO') mapLeft.fitBounds(layer.getBounds()); // Zoom auto sur OSO
                    console.log(name + " chargé !");
                })
                .catch(err => {
                    console.error(err);
                    alert(`ERREUR CHARGEMENT ${name} :\n\n1. Vérifie que le fichier "${url}" existe bien dans le dossier.\n2. Vérifie qu'il est bien converti en .geojson (pas .gpkg).\n3. Vérifie que tu es bien sur http://localhost:8000`);
                });
        }

        // Lancement des chargements
        // Vérifie que ces noms de fichiers sont EXACTEMENT ceux dans ton dossier 'donne'
        loadLayer('donne/OSO_2023_DALLE_2.geojson', mapLeft, styleOCS, 'OSO');
        loadLayer('donne/COSIA_2024_DALLE_2.geojson', mapRight, styleOCS, 'COSIA');
        
        // Cadastre (Transparent)
        var styleCadastre = { color: '#FFF', weight: 0.8, fill: false, opacity: 0.5 };
        loadLayer('donne/CADASTRE_DALLE_2.geojson', mapLeft, styleCadastre, 'Cadastre');
        loadLayer('donne/CADASTRE_DALLE_2.geojson', mapRight, styleCadastre, 'Cadastre');

        // --- PAGE 3 (Minimal) ---
        var mapViz = L.map('map-viz', {zoomControl:false}).setView([43.1026, 2.4140], 9);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(mapViz);
    </script>
</body>
</html>